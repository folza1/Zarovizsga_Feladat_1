<!DOCTYPE html>
<html>
<head>
    <title>Page Title</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>

<style>
    .progress-bar-container {
        position: relative;
    }

    .progress-bar {
        height: 2px;
        background-color: red;
        width: 0%;
        position: absolute;
        bottom: 0;
    }
</style>

<div class="border m-4 p-4 w-1/2 mx-auto rounded">
    <p class="text-center font-bold text-3xl">Szavazzon!</p>
    <p class="text-center font-bold text-xl">Ki fogja nyerni a következő tenisztornát?</p>

    <div>
        <form id="szavazasForm" action="/" method="post">

            <p class="font-bold text-xl">Válassz teniszezőt:</p>
            <label>
                <input type="radio" name="teniszezo" value="djokovic" required> Djokovic Novak
            </label>
            <div class="progress-bar-container">
                <div class="progress-bar" id="djokovic_progress"></div>
                <span class="percentage" id="djokovic_percentage">0%</span>
            </div>
            <br>
            <label>
                <input type="radio" name="teniszezo" value="alcaraz" required> Alcaraz Carlos
            </label>
            <div class="progress-bar-container">
                <div class="progress-bar" id="alcaraz_progress"></div>
                <span class="percentage" id="alcaraz_percentage">0%</span>
            </div>
            <br>
            <label>
                <input type="radio" name="teniszezo" value="medvedev" required> Medvedev Daniil
            </label>
            <div class="progress-bar-container">
                <div class="progress-bar" id="medvedev_progress"></div>
                <span class="percentage" id="medvedev_percentage">0%</span>
            </div>
            <br>
            <label>
                <input type="radio" name="teniszezo" value="sinner" required> Sinner Jannik
            </label>
            <div class="progress-bar-container">
                <div class="progress-bar" id="sinner_progress"></div>
                <span class="percentage" id="sinner_percentage">0%</span>
            </div>
            <br>

            <button class="border bg-red-500 p-2 my-2" type="button" onclick="feldolgozas()" id="szavazasGomb" disabled>Szavazás</button>
        </form>
    </div>
    <p>Összes szavazat: <span id="osszesSzavazat">0</span></p>
    <p>Djokovic szavazatok: <span class="szavazatok" id="djokovicSzavazatok">0</span></p>
    <p>Alcaraz szavazatok: <span class="szavazatok" id="alcarazSzavazatok">0</span></p>
    <p>Medvedev szavazatok: <span class="szavazatok" id="medvedevSzavazatok">0</span></p>
    <p>Sinner szavazatok: <span class="szavazatok" id="sinnerSzavazatok">0</span></p>
</div>

<script>
    var radioButtons = document.querySelectorAll('input[name="teniszezo"]');
    var szavazasGomb = document.getElementById('szavazasGomb');
    var osszesSzavazatElem = document.getElementById('osszesSzavazat');
    var szavazatokElemek = document.querySelectorAll('.szavazatok'); // Hozzáadott sor
    var progressBars = document.querySelectorAll('.progress-bar');
    var percentageElements = document.querySelectorAll('.percentage');

    radioButtons.forEach(function(radioButton) {
        radioButton.addEventListener('change', function() {
            szavazasGomb.disabled = false;
        });
    });

    var all_votes = 0;
    var djokovic = 0;
    var alcaraz = 0;
    var medvedev = 0;
    var sinner = 0;

    // Betöltjük a szavazatokat a localStorage-ból
    function loadVotesFromLocalStorage() {
        all_votes = parseInt(localStorage.getItem('all_votes')) || 0;
        djokovic = parseInt(localStorage.getItem('djokovic_votes')) || 0;
        alcaraz = parseInt(localStorage.getItem('alcaraz_votes')) || 0;
        medvedev = parseInt(localStorage.getItem('medvedev_votes')) || 0;
        sinner = parseInt(localStorage.getItem('sinner_votes')) || 0;

        updateProgressBars();
        osszesSzavazatElem.innerText = all_votes;  // Hozzáadott sor
    }

    // Az oldal betöltésekor futtatjuk a függvényt
    loadVotesFromLocalStorage();

    function feldolgozas() {
        all_votes++;
        osszesSzavazatElem.innerText = all_votes;

        var selectedRadio = document.querySelector('input[name="teniszezo"]:checked');
        if (selectedRadio) {
            var selectedValue = selectedRadio.value;
            switch (selectedValue) {
                case 'djokovic':
                    djokovic++;
                    break;
                case 'alcaraz':
                    alcaraz++;
                    break;
                case 'medvedev':
                    medvedev++;
                    break;
                case 'sinner':
                    sinner++;
                    break;
            }
            // Elmentjük a szavazatokat a localStorage-ba
            saveVotesToLocalStorage();
            updateProgressBars();
        }
    }

    function updateProgressBars() {
        progressBars.forEach(function(bar, index) {
            var votes = 0;
            switch (bar.id) {
                case 'djokovic_progress':
                    votes = djokovic;
                    break;
                case 'alcaraz_progress':
                    votes = alcaraz;
                    break;
                case 'medvedev_progress':
                    votes = medvedev;
                    break;
                case 'sinner_progress':
                    votes = sinner;
                    break;
            }
            var percentage = (votes / all_votes) * 100;
            bar.style.width = percentage + '%';
            szavazatokElemek[index].innerText = votes;
            percentageElements[index].innerText = percentage.toFixed(2) + '%';
        });
    }

    function saveVotesToLocalStorage() {
        localStorage.setItem('all_votes', all_votes);
        localStorage.setItem('djokovic_votes', djokovic);
        localStorage.setItem('alcaraz_votes', alcaraz);
        localStorage.setItem('medvedev_votes', medvedev);
        localStorage.setItem('sinner_votes', sinner);
    }
</script>

</body>
</html>
